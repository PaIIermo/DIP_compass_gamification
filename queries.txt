SELECT COUNT(*) FROM eudl.content;


SELECT COUNT(*) FROM eudl.content WHERE confy_id IS NOT NULL;


SELECT COUNT(*)
FROM eudl.content c
JOIN confy.submission s ON c.confy_id = s.id;


SELECT COUNT(*)
FROM eudl.content c
JOIN confy.submission s ON c.confy_id = s.id
WHERE s.camera_ready_of IS NOT NULL;


SELECT COUNT(*)
FROM eudl.content c
JOIN confy.submission s ON c.confy_id = s.id
JOIN compass."Event" e ON s.conference = e.lisperator_id
WHERE s.camera_ready_of IS NOT NULL;


SELECT COUNT(*)
FROM eudl.content c
JOIN confy.submission s ON c.confy_id = s.id
JOIN compass."Event" e ON s.conference = e.lisperator_id
LEFT JOIN eudl.content_metadata cm ON c.id = cm.content AND cm.key = 'copyright_embargo_ends'
WHERE s.camera_ready_of IS NOT NULL
  AND (cm.value IS NULL OR TO_DATE(cm.value, 'YYYY-MM-DD') < CURRENT_DATE);


SELECT COUNT(*)
FROM (
  SELECT 1
  FROM eudl.content c
  JOIN confy.submission s ON c.confy_id = s.id
  JOIN compass."Event" e ON s.conference = e.lisperator_id
  LEFT JOIN eudl.content_metadata cm ON c.id = cm.content AND cm.key = 'copyright_embargo_ends'
  LEFT JOIN confy.review r ON s.camera_ready_of = r.submission AND r.reviewer_state = 'reviewer-submitted'
  LEFT JOIN confy.review_field rf ON r.id = rf.review AND rf.meta_key = 'overall-recommendation'
  WHERE s.camera_ready_of IS NOT NULL
    AND (cm.value IS NULL OR TO_DATE(cm.value, 'YYYY-MM-DD') < CURRENT_DATE)
  GROUP BY s.camera_ready_of
  HAVING AVG(rf."index") IS NOT NULL
) AS filtered_entries;


SELECT COUNT(*)
FROM (
  SELECT 1
  FROM eudl.content c
  JOIN confy.submission s ON c.confy_id = s.id
  JOIN compass."Event" e ON s.conference = e.lisperator_id
  LEFT JOIN eudl.content_metadata cm ON c.id = cm.content AND cm.key = 'copyright_embargo_ends'
  LEFT JOIN confy.review r ON s.camera_ready_of = r.submission AND r.reviewer_state = 'reviewer-submitted'
  LEFT JOIN confy.review_field rf ON r.id = rf.review AND rf.meta_key = 'overall-recommendation'
  WHERE s.camera_ready_of IS NOT NULL
    AND (cm.value IS NULL OR TO_DATE(cm.value, 'YYYY-MM-DD') < CURRENT_DATE)
  GROUP BY s.id
  HAVING AVG(rf."index") IS NOT NULL
) AS filtered_entries;




SELECT s.id, s.camera_ready_of
FROM eudl.content c
JOIN confy.submission s ON c.confy_id = s.id
JOIN compass."Event" e ON s.conference = e.lisperator_id
LEFT JOIN eudl.content_metadata cm
  ON c.id = cm.content
  AND cm.key = 'copyright_embargo_ends'
LEFT JOIN confy.review r
  ON s.camera_ready_of = r.submission
  AND r.reviewer_state = 'reviewer-submitted'
LEFT JOIN confy.review_field rf
  ON r.id = rf.review
  AND rf.meta_key = 'overall-recommendation'
WHERE (cm.value IS NULL OR TO_DATE(cm.value, 'YYYY-MM-DD') < CURRENT_DATE)
  AND s.camera_ready_of IS NOT NULL
GROUP BY s.camera_ready_of, s.id
HAVING AVG(rf."index") IS NOT NULL
   AND s.camera_ready_of IN (
     SELECT s.camera_ready_of
     FROM eudl.content c
     JOIN confy.submission s ON c.confy_id = s.id
     JOIN compass."Event" e ON s.conference = e.lisperator_id
     LEFT JOIN eudl.content_metadata cm
       ON c.id = cm.content
       AND cm.key = 'copyright_embargo_ends'
     LEFT JOIN confy.review r
       ON s.camera_ready_of = r.submission
       AND r.reviewer_state = 'reviewer-submitted'
     LEFT JOIN confy.review_field rf
       ON r.id = rf.review
       AND rf.meta_key = 'overall-recommendation'
     WHERE (cm.value IS NULL OR TO_DATE(cm.value, 'YYYY-MM-DD') < CURRENT_DATE)
       AND s.camera_ready_of IS NOT NULL
     GROUP BY s.camera_ready_of
     HAVING COUNT(DISTINCT s.id) > 1 AND AVG(rf."index") IS NOT NULL
   )
ORDER BY s.camera_ready_of, s.id;
